apiVersion: v1
kind: Pod
metadata:
  name: {{ .Chart.Name }}-bootstrap-sentinel
  labels:
    app.kubernetes.io/name: {{ include "helm.name" . }}
    helm.sh/chart: {{ include "helm.chart" . }}
    app.kubernetes.io/instance: {{ .Chart.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/service: bootstrap
spec:
  containers:
  - name: {{ .Chart.Name }}
    image: busybox
    imagePullPolicy: Always
    command: ['sh', '-c', 'sleep 300s']
    resources:
      requests:
        memory: "64Mi"
        cpu: "100m"
      limits:
        memory: "128Mi"
        cpu: "200m"
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      privileged: false
      readOnlyRootFilesystem: true
      runAsGroup: 2000
      runAsNonRoot: true
      runAsUser: 1000
      {{- if gt (.Capabilities.KubeVersion.Minor | int) 18 }}
      seccompProfile:
        type: RuntimeDefault
      {{- end }}
  restartPolicy: Never
